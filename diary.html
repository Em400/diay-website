<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <title>Diary</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Diary</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" id="search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" id="btnSearch" type="submit" onclick="searchWord()">Search</button>
            </form>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="d-flex justify-content-center align-items-center">
            <div class="mb-3 justify-content-center">
                <div class="text-center">
                    <h2 class="h2">My Diary</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid main">
        <div class="d-flex justify-content-center align-items-center">
            <div class="mb-3 justify-content-center">
                <div class="text-center">
                    <label for="exampleTextArea" class="form-label">Write Here</label>
                </div>
                <div class="position-relative">
                    <div id="highlightContainer" class="highlight-container"></div>
                    <textarea class="form-control" id="exampleTextArea" rows="12"></textarea>
                </div>
                
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="d-flex justify-content-center align-items-center">
            <div class="text-center">
                <h3 class="h3">
                    Day <span id="num">1</span>
                    <small id="dateLabel" class="text-muted ml-2"></small>
                </h3>
                <i class='fas fa-angle-left' id="decrement" style='font-size:36px'></i>
                <i class='fas fa-angle-right' id="increment" style='font-size:36px'></i>
            </div>
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<script src="./logic.js" type="text/javascript"></script>
<script>
    $(function () {
        const STORAGE_KEY = "diaryEntries.v1";
        const BASE_DATE_KEY = "diaryBaseDate.v1";
        let count = Number(localStorage.getItem("currentDay")) || 1; // resume where you left off

        // --- base date (Day 1) ---
        let baseDateStr = localStorage.getItem(BASE_DATE_KEY);
        if (!baseDateStr) {
            const now = new Date();
            now.setHours(0, 0, 0, 0);           // local midnight
            baseDateStr = now.toISOString();    // store once
            localStorage.setItem(BASE_DATE_KEY, baseDateStr);
        }

        // --- helpers ---
        const getEntries = () => {
            try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
            catch { return {}; }
        };
        const setEntries = (obj) => localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));

        function dayToDate(day) {
            const d = new Date(baseDateStr);
            d.setDate(d.getDate() + (day - 1));
            return d;
        }

        function formatDate(d) {
            return d.toLocaleDateString(undefined, {
                weekday: "short", month: "short", day: "numeric", year: "numeric"
            });
        }

        function updateDateLabel() {
            const d = dayToDate(count);
            $("#dateLabel").text(formatDate(d));
        }

        function saveCurrent() {
            const val = $("#exampleTextArea").val();
            const trimmed = val.trim();
            const entries = getEntries();

            if (trimmed === "" || trimmed.toLowerCase() === "none") {
                delete entries[count];
            } else {
                entries[count] = val;
            }
            setEntries(entries);
            localStorage.setItem("currentDay", String(count));
        }

        function loadEntry() {
            $("#num").text(count);
            const entries = getEntries();
            const text = entries[count];
            $("#exampleTextArea").val(typeof text === "string" && text.length > 0 ? text : "none");
            updateDateLabel();
            localStorage.setItem("currentDay", String(count));
        }

        // Clear the placeholder "none" on focus
        $("#exampleTextArea").on("focus", function () {
            if ($(this).val().trim().toLowerCase() === "none") $(this).val("");
        });

        // Save as the user types
        $("#exampleTextArea").on("input", saveCurrent);

        // Navigate days
        $("#increment").on("click", function () {
            saveCurrent();
            count++;
            loadEntry();
        });

        $("#decrement").on("click", function () {
            if (count > 1) {
                saveCurrent();
                count--;
                loadEntry();
            }
        });

        // Initial render
        loadEntry();
    });
</script>


</html>